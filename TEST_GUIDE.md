# è®¢é˜…æ¶ˆæ¯åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ä¸€ã€å‡†å¤‡å·¥ä½œ

### 0. é‡è¦ï¼šå¼€å‘ç¯å¢ƒé…ç½®

**åœ¨å¼€å§‹æµ‹è¯•å‰ï¼Œå¿…é¡»å…ˆé…ç½®å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼š**

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»å³ä¸Šè§’ **"è¯¦æƒ…"** æŒ‰é’®
3. é€‰æ‹© **"æœ¬åœ°è®¾ç½®"** æ ‡ç­¾
4. **å‹¾é€‰** **"ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦"**

**ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼Ÿ**
- å¼€å‘ç¯å¢ƒä½¿ç”¨ `localhost` ä¸åœ¨å¾®ä¿¡çš„åˆæ³•åŸŸååˆ—è¡¨ä¸­
- ä¸å…³é—­æ ¡éªŒä¼šæŠ¥ `403 Forbidden` é”™è¯¯
- è¿™ä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®åˆæ³•åŸŸå

### 1. æ£€æŸ¥é…ç½®

**æœåŠ¡ç«¯é…ç½®æ£€æŸ¥ï¼š**

```bash
cd server
# æ£€æŸ¥æ˜¯å¦å·²å®‰è£…ä¾èµ–
pip list | grep -E "flask|requests|apscheduler"

# å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œæ‰§è¡Œ
pip install -r requirements.txt
```

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

åˆ›å»º `server/.env` æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š

```env
WX_APPID=ä½ çš„å°ç¨‹åºAppID
WX_APPSECRET=ä½ çš„å°ç¨‹åºAppSecret
WX_TEMPLATE_ID=_qZfC75otflYg8nc1suRZK27Ke-mzc_sh3Vtpv8tr2w
```

**å°ç¨‹åºé…ç½®æ£€æŸ¥ï¼š**

- ç¡®è®¤ `pages/add/add.js` ä¸­çš„æ¨¡æ¿IDå·²é…ç½®
- ç¡®è®¤ `utils/api.js` ä¸­çš„æœåŠ¡ç«¯åœ°å€é…ç½®æ­£ç¡®

### 2. å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®

1. ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
2. è¿›å…¥ **å¼€å‘** -> **å¼€å‘ç®¡ç†** -> **å¼€å‘è®¾ç½®**
3. ç¡®è®¤ **æœåŠ¡å™¨åŸŸå** å·²é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒå¯è·³è¿‡ï¼‰
4. è¿›å…¥ **åŠŸèƒ½** -> **è®¢é˜…æ¶ˆæ¯**ï¼Œç¡®è®¤æ¨¡æ¿å·²ç”³è¯·

## äºŒã€æœåŠ¡ç«¯æµ‹è¯•

### 1. å¯åŠ¨æœåŠ¡ç«¯

```bash
cd server
python app.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
å¯åŠ¨ Flask æœåŠ¡...
APPID: your-appid
æ¨¡æ¿ID: _qZfC75otflYg8nc1suRZK27Ke-mzc_sh3Vtpv8tr2w
 * Running on http://0.0.0.0:5000
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£

æ‰“å¼€æµè§ˆå™¨æˆ–ä½¿ç”¨ curlï¼š

```bash
curl http://localhost:5000/api/health
```

**é¢„æœŸå“åº”ï¼š**
```json
{
    "errcode": 0,
    "errmsg": "success",
    "status": "healthy"
}
```

### 3. æµ‹è¯•è·å– access_token

åœ¨æœåŠ¡ç«¯æ—¥å¿—ä¸­æŸ¥çœ‹ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è·å– access_tokenã€‚

**æ£€æŸ¥æ—¥å¿—ï¼š**
```
è·å– access_token æˆåŠŸ
```

### 4. æµ‹è¯•ç”¨æˆ·ç™»å½•æ¥å£ï¼ˆè·å– openidï¼‰

#### æ–¹æ³•1ï¼šä»å°ç¨‹åºè·å– codeï¼ˆæ¨èï¼‰

1. **åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š**
   - æ‰“å¼€å°ç¨‹åºé¡¹ç›®
   - æ‰“å¼€"è°ƒè¯•å™¨" -> "Console"
   - åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š

```javascript
wx.login({
  success: (res) => {
    console.log('è·å–åˆ°çš„ code:', res.code)
    // å¤åˆ¶è¿™ä¸ª code ç”¨äºæµ‹è¯•
  }
})
```

2. **ä½¿ç”¨è·å–åˆ°çš„ code æµ‹è¯•æ¥å£ï¼š**

```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"code": "0f3SKLkl2cMOKg4zStol2S5cVZ1SKLk3"}'
```

**æ³¨æ„ï¼š**
- code åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œæ¯æ¬¡è°ƒç”¨ `wx.login()` éƒ½ä¼šè·å–æ–°çš„ code
- code æœ‰æ•ˆæœŸ 5 åˆ†é’Ÿ
- å¦‚æœ code å·²ä½¿ç”¨è¿‡ï¼Œä¼šè¿”å› `40029: code been used`

#### æ–¹æ³•2ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

åœ¨å°ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•é¡µé¢ï¼Œæˆ–è€…ç›´æ¥åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// åœ¨å°ç¨‹åºæ§åˆ¶å°æ‰§è¡Œ
wx.login({
  success: (res) => {
    if (res.code) {
      // ç›´æ¥è°ƒç”¨æœåŠ¡ç«¯æ¥å£
      wx.request({
        url: 'http://localhost:5000/api/auth/login',
        method: 'POST',
        data: {
          code: res.code
        },
        success: (result) => {
          console.log('ç™»å½•ç»“æœ:', result.data)
          if (result.data.errcode === 0) {
            console.log('openid:', result.data.data.openid)
          }
        }
      })
    }
  }
})
```

#### æ–¹æ³•3ï¼šè·³è¿‡ç™»å½•æµ‹è¯•ï¼ˆç›´æ¥ä½¿ç”¨ openidï¼‰

å¦‚æœåªæ˜¯æƒ³æµ‹è¯•å…¶ä»–æ¥å£ï¼Œå¯ä»¥è·³è¿‡ç™»å½•ï¼Œç›´æ¥ä½¿ç”¨ä¸€ä¸ªæµ‹è¯• openidï¼š

```bash
# ç›´æ¥ä½¿ç”¨æµ‹è¯• openidï¼ˆä¸æ¨èï¼Œä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼‰
# çœŸå®çš„ openid éœ€è¦é€šè¿‡ code æ¢å–
```

### 5. æµ‹è¯•åˆ›å»ºæé†’æ¥å£

```bash
curl -X POST http://localhost:5000/api/reminder \
  -H "Content-Type: application/json" \
  -d '{
    "openid": "test_openid",
    "title": "æµ‹è¯•æé†’",
    "time": "æ˜å¤© 10:00",
    "reminderTime": 1704067200000,
    "enableSubscribe": true
  }'
```

**é¢„æœŸå“åº”ï¼š**
```json
{
    "errcode": 0,
    "errmsg": "success",
    "data": {
        "id": 1704067200000
    }
}
```

**æ£€æŸ¥æ—¥å¿—ï¼š**
```
åˆ›å»ºæé†’æˆåŠŸ: 1704067200000
å·²å®‰æ’æé†’ä»»åŠ¡: 1704067200000, æ—¶é—´: 2024-01-01 10:00:00
```

## ä¸‰ã€å°ç¨‹åºç«¯æµ‹è¯•

### 1. é…ç½®æœåŠ¡ç«¯åœ°å€

ç¼–è¾‘ `utils/api.js`ï¼š

```javascript
// å¼€å‘ç¯å¢ƒ
const API_BASE_URL = 'http://localhost:5000/api'

// æˆ–è€…ä½¿ç”¨å±€åŸŸç½‘IPï¼ˆçœŸæœºæµ‹è¯•æ—¶ï¼‰
// const API_BASE_URL = 'http://192.168.1.100:5000/api'
```

**æ³¨æ„**ï¼šçœŸæœºæµ‹è¯•æ—¶ï¼Œéœ€è¦ä½¿ç”¨ç”µè„‘çš„å±€åŸŸç½‘IPåœ°å€ï¼Œä¸èƒ½ä½¿ç”¨ `localhost`ã€‚

### 2. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•

#### æ­¥éª¤1ï¼šæ‰“å¼€é¡¹ç›®
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. å¯¼å…¥é¡¹ç›®ç›®å½•
3. ç¡®è®¤ AppID å·²é…ç½®

#### æ­¥éª¤1.5ï¼šå…³é—­åŸŸåæ ¡éªŒï¼ˆå¼€å‘ç¯å¢ƒå¿…éœ€ï¼‰

**é‡è¦ï¼š** å¼€å‘ç¯å¢ƒä½¿ç”¨ `localhost` æ—¶ï¼Œå¿…é¡»å…³é—­åŸŸåæ ¡éªŒï¼Œå¦åˆ™ä¼šæŠ¥ 403 é”™è¯¯ã€‚

**æ–¹æ³•ï¼š**
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ **"è¯¦æƒ…"** æŒ‰é’®
2. é€‰æ‹© **"æœ¬åœ°è®¾ç½®"** æ ‡ç­¾
3. å‹¾é€‰ **"ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦"**
4. å…³é—­è¯¦æƒ…çª—å£

**æ³¨æ„ï¼š**
- è¿™ä»…ç”¨äºå¼€å‘ç¯å¢ƒæµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®åˆæ³•çš„æœåŠ¡å™¨åŸŸå
- çœŸæœºé¢„è§ˆæ—¶ï¼Œå»ºè®®ä½¿ç”¨å±€åŸŸç½‘IPè€Œä¸æ˜¯ localhost

**å¦‚æœä»ç„¶æŠ¥ 403 é”™è¯¯ï¼š**
- æ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦å·²å¯åŠ¨
- ç¡®è®¤æœåŠ¡ç«¯åœ°å€æ˜¯å¦æ­£ç¡®
- å°è¯•ä½¿ç”¨å±€åŸŸç½‘IPä»£æ›¿ localhost

#### æ­¥éª¤2ï¼šè·å– codeï¼ˆç”¨äºæµ‹è¯•æ¥å£ï¼‰
åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
wx.login({
  success: (res) => {
    console.log('è·å–åˆ°çš„ code:', res.code)
    // å¤åˆ¶è¿™ä¸ª code ç”¨äº curl æµ‹è¯•
  }
})
```

#### æ­¥éª¤3ï¼šæµ‹è¯•æ·»åŠ æé†’
1. ç‚¹å‡»å³ä¸‹è§’"+"æŒ‰é’®
2. è¾“å…¥æé†’å†…å®¹
3. é€‰æ‹©æé†’æ—¶é—´
4. å¼€å¯"å¼€å¯æ¶ˆæ¯æé†’"å¼€å…³
5. ç‚¹å‡»"ä¿å­˜"

**é¢„æœŸè¡Œä¸ºï¼š**
- å¼¹å‡ºè®¢é˜…æ¶ˆæ¯æˆæƒå¼¹çª—
- ç”¨æˆ·ç‚¹å‡»"å…è®¸"åï¼Œæ˜¾ç¤º"è®¢é˜…æˆåŠŸ"
- æ˜¾ç¤º"æ·»åŠ æˆåŠŸ"æç¤º
- è¿”å›é¦–é¡µï¼Œæ–°æé†’æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨

#### æ­¥éª¤4ï¼šæ£€æŸ¥æ§åˆ¶å°
æ‰“å¼€å¼€å‘è€…å·¥å…·çš„"è°ƒè¯•å™¨" -> "Console"ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š

```
æé†’å·²ä¿å­˜åˆ°æœåŠ¡ç«¯ï¼Œå°†åœ¨æŒ‡å®šæ—¶é—´å‘é€è®¢é˜…æ¶ˆæ¯
```

**æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼š**
- æ‰“å¼€"è°ƒè¯•å™¨" -> "Network"
- å¯ä»¥çœ‹åˆ°å‘é€åˆ°æœåŠ¡ç«¯çš„è¯·æ±‚
- æŸ¥çœ‹è¯·æ±‚å‚æ•°å’Œå“åº”ç»“æœ

### 3. çœŸæœºæµ‹è¯•

#### é…ç½®æ­¥éª¤ï¼š

1. **ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘**

2. **è·å–ç”µè„‘IPåœ°å€ï¼š**
   ```bash
   # macOS/Linux
   ifconfig | grep "inet "
   
   # Windows
   ipconfig
   ```

3. **ä¿®æ”¹å°ç¨‹åºä»£ç ä¸­çš„æœåŠ¡ç«¯åœ°å€ï¼š**
   ```javascript
   // utils/api.js
   const API_BASE_URL = 'http://192.168.1.100:5000/api'  // æ›¿æ¢ä¸ºä½ çš„IP
   ```

4. **é…ç½®æœåŠ¡ç«¯å…è®¸è·¨åŸŸï¼š**
   æœåŠ¡ç«¯å·²é…ç½® CORSï¼Œæ— éœ€é¢å¤–é…ç½®

5. **åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š**
   - ç‚¹å‡»"é¢„è§ˆ"
   - ç”¨å¾®ä¿¡æ‰«ç 
   - åœ¨æ‰‹æœºä¸Šæµ‹è¯•

## å››ã€ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹

### å®Œæ•´æµ‹è¯•æ­¥éª¤ï¼š

1. **å¯åŠ¨æœåŠ¡ç«¯**
   ```bash
   cd server
   python app.py
   ```

2. **åœ¨å°ç¨‹åºä¸­æ·»åŠ æé†’**
   - æ‰“å¼€å°ç¨‹åº
   - ç‚¹å‡»"+"æŒ‰é’®
   - è¾“å…¥ï¼š"æµ‹è¯•æé†’ - æ˜å¤©10ç‚¹å¼€ä¼š"
   - é€‰æ‹©æ—¶é—´ï¼šæ˜å¤© 10:00
   - å¼€å¯è®¢é˜…å¼€å…³
   - ç‚¹å‡»"ä¿å­˜"
   - æˆæƒè®¢é˜…æ¶ˆæ¯

3. **éªŒè¯æœåŠ¡ç«¯æ¥æ”¶**
   æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—ï¼š
   ```
   åˆ›å»ºæé†’æˆåŠŸ: 1704067200000
   å·²å®‰æ’æé†’ä»»åŠ¡: 1704067200000, æ—¶é—´: 2024-01-02 10:00:00
   ```

4. **æµ‹è¯•å®šæ—¶å‘é€ï¼ˆæ¨¡æ‹Ÿï¼‰**
   
   ä¸ºäº†å¿«é€Ÿæµ‹è¯•ï¼Œå¯ä»¥ä¿®æ”¹æé†’æ—¶é—´ä¸ºå½“å‰æ—¶é—´åå‡ åˆ†é’Ÿï¼š
   
   ```python
   # åœ¨ server/app.py çš„ schedule_reminder å‡½æ•°ä¸­
   # ä¸´æ—¶ä¿®æ”¹ä¸ºå½“å‰æ—¶é—´å1åˆ†é’Ÿï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
   reminder_time = datetime.now() + timedelta(minutes=1)
   ```

5. **ç­‰å¾…æé†’æ—¶é—´åˆ°è¾¾**
   - ç­‰å¾…åˆ°æŒ‡å®šæ—¶é—´
   - æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—ï¼š
     ```
     æé†’å‘é€æˆåŠŸ: 1704067200000
     ```
   - æ£€æŸ¥å¾®ä¿¡æ˜¯å¦æ”¶åˆ°è®¢é˜…æ¶ˆæ¯

## äº”ã€å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæœåŠ¡ç«¯æ— æ³•å¯åŠ¨

**é”™è¯¯ï¼š** `ModuleNotFoundError: No module named 'flask'`

**è§£å†³ï¼š**
```bash
pip install -r requirements.txt
```

### é—®é¢˜2ï¼šè·å– access_token å¤±è´¥

**æ£€æŸ¥ï¼š**
1. AppID å’Œ AppSecret æ˜¯å¦æ­£ç¡®
2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—é”™è¯¯ä¿¡æ¯

**è§£å†³ï¼š**
```python
# æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„é…ç½®
WX_APPID=æ­£ç¡®çš„AppID
WX_APPSECRET=æ­£ç¡®çš„AppSecret
```

### é—®é¢˜3ï¼šå°ç¨‹åºæ— æ³•è¿æ¥æœåŠ¡ç«¯

**é”™è¯¯ï¼š** `request:fail` æˆ– `403 Forbidden`

**æ£€æŸ¥ï¼š**
1. æœåŠ¡ç«¯æ˜¯å¦å·²å¯åŠ¨
2. æœåŠ¡ç«¯åœ°å€æ˜¯å¦æ­£ç¡®
3. æ˜¯å¦å…³é—­äº†åŸŸåæ ¡éªŒï¼ˆå¼€å‘ç¯å¢ƒï¼‰
4. çœŸæœºæµ‹è¯•æ—¶æ˜¯å¦ä½¿ç”¨äº†å±€åŸŸç½‘IP

**è§£å†³ï¼š**

**å¼€å‘ç¯å¢ƒï¼ˆå¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼‰ï¼š**
1. ç‚¹å‡»å³ä¸Šè§’ **"è¯¦æƒ…"** -> **"æœ¬åœ°è®¾ç½®"**
2. å‹¾é€‰ **"ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦"**
3. ä½¿ç”¨ `http://localhost:5000` æˆ–å±€åŸŸç½‘IP

**çœŸæœºæµ‹è¯•ï¼š**
- å¿…é¡»ä½¿ç”¨å±€åŸŸç½‘IPï¼š`http://192.168.x.x:5000`
- ä¸èƒ½ä½¿ç”¨ `localhost`
- ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€å±€åŸŸç½‘

**ç”Ÿäº§ç¯å¢ƒï¼š**
- å¿…é¡»é…ç½®åˆæ³•çš„æœåŠ¡å™¨åŸŸå
- å¿…é¡»ä½¿ç”¨ HTTPS
- åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®æœåŠ¡å™¨åŸŸå

### é—®é¢˜4ï¼šè®¢é˜…æ¶ˆæ¯æˆæƒå¤±è´¥

**é”™è¯¯ï¼š** ç”¨æˆ·ç‚¹å‡»"æ‹’ç»"æˆ–æˆæƒå¤±è´¥

**æ£€æŸ¥ï¼š**
1. æ¨¡æ¿IDæ˜¯å¦æ­£ç¡®
2. æ¨¡æ¿æ˜¯å¦å·²ç”³è¯·å¹¶é€šè¿‡
3. ç”¨æˆ·æ˜¯å¦å·²æˆæƒè¿‡ï¼ˆéœ€è¦é‡æ–°æˆæƒï¼‰

**è§£å†³ï¼š**
- ç¡®è®¤æ¨¡æ¿IDï¼š`_qZfC75otflYg8nc1suRZK27Ke-mzc_sh3Vtpv8tr2w`
- æ£€æŸ¥å¾®ä¿¡å…¬ä¼—å¹³å°ä¸­çš„æ¨¡æ¿çŠ¶æ€

### é—®é¢˜5ï¼šè®¢é˜…æ¶ˆæ¯æœªå‘é€

**æ£€æŸ¥ï¼š**
1. æœåŠ¡ç«¯å®šæ—¶ä»»åŠ¡æ˜¯å¦æ­£å¸¸
2. æé†’æ—¶é—´æ˜¯å¦å·²è¿‡
3. æœåŠ¡ç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

**è§£å†³ï¼š**
```python
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡åˆ—è¡¨
scheduler.print_jobs()

# æ£€æŸ¥æé†’æ—¶é—´
reminder_time = datetime.fromtimestamp(reminder['reminderTime'] / 1000)
print(f"æé†’æ—¶é—´: {reminder_time}, å½“å‰æ—¶é—´: {datetime.now()}")
```

### é—®é¢˜6ï¼šopenid è·å–å¤±è´¥

**æ£€æŸ¥ï¼š**
1. code æ˜¯å¦æœ‰æ•ˆï¼ˆcode åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼‰
2. AppID å’Œ AppSecret æ˜¯å¦æ­£ç¡®
3. code æ˜¯å¦å·²è¿‡æœŸï¼ˆæœ‰æ•ˆæœŸ 5 åˆ†é’Ÿï¼‰

**è§£å†³ï¼š**
- ç¡®ä¿æ¯æ¬¡è°ƒç”¨éƒ½ä½¿ç”¨æ–°çš„ codeï¼ˆé‡æ–°è°ƒç”¨ `wx.login()`ï¼‰
- æ£€æŸ¥å¾®ä¿¡å…¬ä¼—å¹³å°çš„ AppID å’Œ AppSecret
- å¦‚æœ code å·²ä½¿ç”¨ï¼Œä¼šè¿”å›é”™è¯¯ï¼š`40029: code been used`

**å¦‚ä½•è·å–æ–°çš„ codeï¼š**
```javascript
// åœ¨å°ç¨‹åºæ§åˆ¶å°æˆ–ä»£ç ä¸­
wx.login({
  success: (res) => {
    console.log('æ–°çš„ code:', res.code)
  }
})
```

## å…­ã€è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—

æœåŠ¡ç«¯ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
```
INFO:__main__:è·å– access_token æˆåŠŸ
INFO:__main__:åˆ›å»ºæé†’æˆåŠŸ: 1704067200000
INFO:__main__:å·²å®‰æ’æé†’ä»»åŠ¡: 1704067200000, æ—¶é—´: 2024-01-02 10:00:00
```

### 2. æŸ¥çœ‹å°ç¨‹åºæ—¥å¿—

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
- æ‰“å¼€"è°ƒè¯•å™¨" -> "Console"
- æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼š"Network"
- æŸ¥çœ‹å­˜å‚¨æ•°æ®ï¼š"Storage"

### 3. æµ‹è¯•è®¢é˜…æ¶ˆæ¯å‘é€

å¯ä»¥æ‰‹åŠ¨è°ƒç”¨å‘é€æ¥å£æµ‹è¯•ï¼š

```python
# åœ¨ Python æ§åˆ¶å°ä¸­
from app import send_subscribe_message

result = send_subscribe_message(
    openid='ç”¨æˆ·çš„openid',
    template_id='_qZfC75otflYg8nc1suRZK27Ke-mzc_sh3Vtpv8tr2w',
    page='pages/index/index',
    data={
        'thing1': {'value': 'æµ‹è¯•æé†’'},
        'time2': {'value': 'æ˜å¤© 10:00'}
    }
)
print(result)
```

### 4. æ£€æŸ¥å®šæ—¶ä»»åŠ¡

```python
# åœ¨ Python æ§åˆ¶å°ä¸­
from app import scheduler

# æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
print(scheduler.get_jobs())

# æŸ¥çœ‹ç‰¹å®šä»»åŠ¡
job = scheduler.get_job('reminder_1704067200000')
print(job)
```

## ä¸ƒã€æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡ç«¯æˆåŠŸå¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥æ¥å£æ­£å¸¸
- [ ] access_token è·å–æˆåŠŸ
- [ ] å°ç¨‹åºå¯ä»¥è¿æ¥æœåŠ¡ç«¯
- [ ] ç”¨æˆ·ç™»å½•æ¥å£æ­£å¸¸ï¼ˆè·å– openidï¼‰
- [ ] åˆ›å»ºæé†’æ¥å£æ­£å¸¸
- [ ] è®¢é˜…æ¶ˆæ¯æˆæƒæˆåŠŸ
- [ ] å®šæ—¶ä»»åŠ¡å·²åˆ›å»º
- [ ] è®¢é˜…æ¶ˆæ¯æˆåŠŸå‘é€
- [ ] å¾®ä¿¡æ”¶åˆ°è®¢é˜…æ¶ˆæ¯

## å…«ã€å¿«é€Ÿæµ‹è¯•è„šæœ¬

åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬ `server/test.py`ï¼š

```python
import requests
import json
from datetime import datetime, timedelta

BASE_URL = 'http://localhost:5000/api'

# 1. å¥åº·æ£€æŸ¥
print("1. æµ‹è¯•å¥åº·æ£€æŸ¥...")
r = requests.get(f'{BASE_URL}/health')
print(json.dumps(r.json(), indent=2, ensure_ascii=False))

# 2. åˆ›å»ºæé†’ï¼ˆéœ€è¦çœŸå®çš„ openidï¼‰
print("\n2. æµ‹è¯•åˆ›å»ºæé†’...")
reminder_time = int((datetime.now() + timedelta(minutes=5)).timestamp() * 1000)
data = {
    'openid': 'test_openid_123',
    'title': 'æµ‹è¯•æé†’',
    'time': '5åˆ†é’Ÿå',
    'reminderTime': reminder_time,
    'enableSubscribe': True
}
r = requests.post(f'{BASE_URL}/reminder', json=data)
print(json.dumps(r.json(), indent=2, ensure_ascii=False))

# 3. è·å–æé†’åˆ—è¡¨
print("\n3. æµ‹è¯•è·å–æé†’åˆ—è¡¨...")
r = requests.get(f'{BASE_URL}/reminders', params={'openid': 'test_openid_123'})
print(json.dumps(r.json(), indent=2, ensure_ascii=False))
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
cd server
python test.py
```

## ä¹ã€ç”Ÿäº§ç¯å¢ƒæµ‹è¯•

ç”Ÿäº§ç¯å¢ƒæµ‹è¯•å‰ï¼Œéœ€è¦ï¼š

1. **é…ç½® HTTPS**
   - å¾®ä¿¡å°ç¨‹åºè¦æ±‚ä½¿ç”¨ HTTPS
   - é…ç½® SSL è¯ä¹¦

2. **é…ç½®åŸŸå**
   - åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®æœåŠ¡å™¨åŸŸå
   - ç¡®ä¿åŸŸåå·²å¤‡æ¡ˆ

3. **ä½¿ç”¨æ•°æ®åº“**
   - æ›¿æ¢å†…å­˜å­˜å‚¨ä¸ºæ•°æ®åº“
   - ç¡®ä¿æ•°æ®æŒä¹…åŒ–

4. **ç›‘æ§å’Œæ—¥å¿—**
   - é…ç½®æ—¥å¿—ç³»ç»Ÿ
   - è®¾ç½®ç›‘æ§å‘Šè­¦

## åã€è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡ç«¯æ—¥å¿—
2. å°ç¨‹åºæ§åˆ¶å°æ—¥å¿—
3. å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®
4. ç½‘ç»œè¿æ¥çŠ¶æ€

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰

